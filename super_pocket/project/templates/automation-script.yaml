name: automation-script
display_name: "Automation Script"
description: "Automation script with scheduling, logging, and configuration"

python_version: ">=3.11"

tool_choices:
  scheduler:
    prompt: "Which scheduler?"
    default: none
    options:
      - name: none
        description: "No scheduler - run manually or via cron"
      - name: cron
        description: "Cron syntax scheduling (python-crontab)"
      - name: apscheduler
        description: "APScheduler - advanced scheduling library"

  config_format:
    prompt: "Which config format?"
    default: yaml
    options:
      - name: yaml
        description: "YAML - human-readable"
      - name: toml
        description: "TOML - Python-friendly"
      - name: json
        description: "JSON - universal"
      - name: env
        description: ".env - environment variables"

  package_manager:
    prompt: "Which package manager?"
    default: uv
    options:
      - name: uv
        description: "uv - blazingly fast (recommended)"
      - name: poetry
        description: "poetry - mature, feature-rich"
      - name: pip
        description: "pip + requirements.txt - simple, universal"

features:
  - name: logging
    description: "Structured logging setup"
    default: true

  - name: notifications
    description: "Error notifications via email/slack"
    default: false

  - name: testing
    description: "Testing setup with pytest"
    default: true

  - name: docker
    description: "Docker containerization"
    default: false

  - name: systemd
    description: "systemd service file"
    default: false

structure:
  - path: "src/{{ project_name }}"
    type: directory

  - path: "src/{{ project_name }}/__init__.py"
    template: "__init__.py.j2"

  - path: "src/{{ project_name }}/runner.py"
    template: "runner.py.j2"

  - path: "src/{{ project_name }}/tasks.py"
    template: "tasks.py.j2"

  - path: "src/{{ project_name }}/config_loader.py"
    template: "config_loader.py.j2"

  - path: "src/{{ project_name }}/logging_config.py"
    template: "logging_config.py.j2"
    condition: "features.logging"

  - path: "src/{{ project_name }}/notifications.py"
    template: "notifications.py.j2"
    condition: "features.notifications"

  - path: "{% if tool_choices.config_format == 'env' %}.env{% else %}config.{{ tool_choices.config_format }}{% endif %}"
    template: "{% if tool_choices.config_format == 'env' %}env.j2{% else %}config.{{ tool_choices.config_format }}.j2{% endif %}"

  - path: "tests"
    type: directory
    condition: "features.testing"

  - path: "tests/__init__.py"
    condition: "features.testing"

  - path: "tests/test_tasks.py"
    template: "test_tasks.py.j2"
    condition: "features.testing"

  - path: "pyproject.toml"
    template: "pyproject_{{ tool_choices.package_manager }}.toml.j2"

  - path: "requirements.txt"
    template: "requirements.txt.j2"
    condition: "tool_choices.package_manager == 'pip'"

  - path: "README.md"
    template: "README.md.j2"

  - path: ".gitignore"
    template: "gitignore.j2"

  - path: "Dockerfile"
    template: "Dockerfile.j2"
    condition: "features.docker"

  - path: "{{ project_name }}.service"
    template: "systemd_service.j2"
    condition: "features.systemd"

post_generation:
  - action: git_init

  - action: create_venv
    params:
      package_manager: "{{ tool_choices.package_manager }}"

  - action: install_dependencies
    params:
      package_manager: "{{ tool_choices.package_manager }}"
      dev: true

  - action: display_next_steps
